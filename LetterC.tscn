[gd_scene load_steps=27 format=3 uid="uid://j81bd4hg1vx"]

[ext_resource type="LabelSettings" uid="uid://bulagoaa3g7q6" path="res://Letter.tres" id="1_qgwdn"]
[ext_resource type="Script" uid="uid://beadd80bw35lj" path="res://ai/tasks/is_target_in_area.gd" id="2_fvx5r"]
[ext_resource type="PackedScene" uid="uid://drgp12k1ee2xn" path="res://components/hurtbox/hurt_box.tscn" id="3_udkfm"]
[ext_resource type="Texture2D" uid="uid://dxfyhld4qs6qp" path="res://red-circle.webp" id="4_qgwdn"]
[ext_resource type="PackedScene" uid="uid://cb2roqwnqe0al" path="res://components/hitbox/hit_box.tscn" id="5_udkfm"]
[ext_resource type="Script" uid="uid://3wtv26ldj4iu" path="res://effects/effect_res.gd" id="6_s5qym"]
[ext_resource type="Script" uid="uid://cik0s5iifa3jx" path="res://effects/slow_effect_res.gd" id="7_dx8kp"]
[ext_resource type="Script" uid="uid://b6q6mmbv7an12" path="res://effects/damage_overtime_effect_res.gd" id="8_dx8kp"]

[sub_resource type="BlackboardPlan" id="BlackboardPlan_7k17h"]
var/nearest_target/name = &"nearest_target"
var/nearest_target/type = 22
var/nearest_target/value = NodePath("")
var/nearest_target/hint = 0
var/nearest_target/hint_string = ""

[sub_resource type="BTCondition" id="BTCondition_j52fi"]
script = ExtResource("2_fvx5r")
area_range = NodePath("Weapon/HitBox")

[sub_resource type="BBNode" id="BBNode_icdpu"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTPlayAnimation" id="BTPlayAnimation_j52fi"]
animation_player = SubResource("BBNode_icdpu")
animation_name = &"attack"

[sub_resource type="BBNode" id="BBNode_fvx5r"]
saved_value = NodePath("AnimationPlayer")
resource_name = "AnimationPlayer"

[sub_resource type="BTAwaitAnimation" id="BTAwaitAnimation_udkfm"]
animation_player = SubResource("BBNode_fvx5r")
animation_name = &"attack"

[sub_resource type="BTSequence" id="BTSequence_u57or"]
children = [SubResource("BTCondition_j52fi"), SubResource("BTPlayAnimation_j52fi"), SubResource("BTAwaitAnimation_udkfm")]

[sub_resource type="BehaviorTree" id="BehaviorTree_qgwdn"]
blackboard_plan = SubResource("BlackboardPlan_7k17h")
root_task = SubResource("BTSequence_u57or")

[sub_resource type="BlackboardPlan" id="BlackboardPlan_gm3ap"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_fgpmi"]
size = Vector2(41, 53)

[sub_resource type="Animation" id="Animation_dc8qm"]
length = 0.8
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Weapon/RedCircle:modulate")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Color(1, 1, 1, 0.43137255)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Weapon/RedCircle:visible")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [true]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("Weapon/HitBox:damage_offset")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [1.0]
}
tracks/3/type = "value"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("Weapon/HitBox:monitoring")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}

[sub_resource type="Animation" id="Animation_fgpmi"]
resource_name = "attack"
length = 0.8
step = 0.2
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Weapon/RedCircle:modulate")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.8),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [Color(1, 1, 1, 0.43137255), Color(1, 1, 1, 0)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Weapon/RedCircle:visible")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.8),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [true, false]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = false
tracks/2/path = NodePath("Weapon/HitBox:damage_offset")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0.0001, 0.8),
"transitions": PackedFloat32Array(1, 1),
"update": 0,
"values": [0.0, 1.0]
}
tracks/3/type = "method"
tracks/3/imported = false
tracks/3/enabled = true
tracks/3/path = NodePath("Weapon/HitBox")
tracks/3/interp = 1
tracks/3/loop_wrap = true
tracks/3/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"values": [{
"args": [],
"method": &"damage_all_in_area"
}]
}

[sub_resource type="Animation" id="Animation_udkfm"]
resource_name = "attack_always"
loop_mode = 1
step = 0.2
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Weapon/HitBox:monitoring")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.5254),
"transitions": PackedFloat32Array(1, 1),
"update": 1,
"values": [true, false]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Weapon/RedCircle:modulate")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.0001, 0.6),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [Color(1, 1, 1, 0.9372549), Color(1, 1, 1, 0.9372549), Color(1, 1, 1, 0.13333334)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_7wl1p"]
_data = {
&"RESET": SubResource("Animation_dc8qm"),
&"attack": SubResource("Animation_fgpmi"),
&"attack_always": SubResource("Animation_udkfm")
}

[sub_resource type="Resource" id="Resource_51m5k"]
script = ExtResource("7_dx8kp")
speed_modifier = 0.5
metadata/_custom_type_script = "uid://cik0s5iifa3jx"

[sub_resource type="Resource" id="Resource_s6wrt"]
script = ExtResource("8_dx8kp")
damage = 3.0
duration = 5.0
interval = 0.5
metadata/_custom_type_script = "uid://b6q6mmbv7an12"

[sub_resource type="Curve" id="Curve_fvx5r"]
_data = [Vector2(0, 1), 0.0, 0.0, 0, 0, Vector2(0.27125502, 1), 0.0, 0.0, 0, 0, Vector2(0.61133593, 0), 0.0, 0.0, 0, 0, Vector2(1, 0), 0.0, 0.0, 0, 0]
point_count = 4

[sub_resource type="CircleShape2D" id="CircleShape2D_usgmu"]
radius = 208.03845

[node name="LetterC" type="Node2D" groups=["soldier"]]

[node name="Label" type="Label" parent="."]
offset_left = -23.0
offset_top = -53.0
offset_right = 23.0
offset_bottom = 43.0
text = "C"
label_settings = ExtResource("1_qgwdn")

[node name="BTPlayer" type="BTPlayer" parent="."]
behavior_tree = SubResource("BehaviorTree_qgwdn")
active = false
blackboard_plan = SubResource("BlackboardPlan_gm3ap")

[node name="HurtBox" parent="." node_paths=PackedStringArray("health_bar", "agent") instance=ExtResource("3_udkfm")]
collision_layer = 1
health_bar = NodePath("ProgressBar")
agent = NodePath("..")

[node name="CollisionShape2D" type="CollisionShape2D" parent="HurtBox"]
position = Vector2(0.5, -3.5)
shape = SubResource("RectangleShape2D_fgpmi")

[node name="ProgressBar" type="ProgressBar" parent="HurtBox"]
offset_left = -60.0
offset_top = -62.0
offset_right = 61.0
offset_bottom = -35.0
value = 100.0

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_7wl1p")
}
autoplay = "attack_always"

[node name="Weapon" type="Node2D" parent="."]

[node name="RedCircle" type="Sprite2D" parent="Weapon"]
modulate = Color(1, 1, 1, 0.43137255)
scale = Vector2(0.83, 0.83)
texture = ExtResource("4_qgwdn")

[node name="HitBox" parent="Weapon" instance=ExtResource("5_udkfm")]
collision_mask = 2
monitoring = false
effects = Array[ExtResource("6_s5qym")]([SubResource("Resource_51m5k"), SubResource("Resource_s6wrt")])
mode = "one_hit"
damage_curve = SubResource("Curve_fvx5r")
damage_offset = 1.0

[node name="CollisionShape2D" type="CollisionShape2D" parent="Weapon/HitBox"]
shape = SubResource("CircleShape2D_usgmu")
